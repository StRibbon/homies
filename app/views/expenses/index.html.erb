<%= render "navbar" %>



<h1 class="first_chart_header">Homie Expenses</h1>
<div id="chartContainer5" style="height: 300px; width: 80%;">
</div>

<h1 class="first_chart_header">Category Breakdown</h1>
<div id="chartContainer1" style="height: 300px; width: 80%">
</div>


<ul>
<% @expenses.each do |expense| %>
<li>
<strong>Name:</strong> <%= expense.name %>
<strong>Cost:</strong> <%= expense.cost %>
<strong>Notes:</strong> <%= expense.notes %>
<strong>Category:</strong> <%= expense.category.name %>

<%= link_to "Edit", edit_expense_path(expense.id) %>
<%= link_to "Delete", expense_path(expense.id), method: :delete, data: { confirm: 'Are you sure?' } %>

</li>
<% end %>
</ul>

<h4>Expense by User</h4>
<% user_id_in_sphere(@id).each do |user|%>
   <% x = user["user_id"] %>
   <% itemized_expense_by_user(@id, x).each do |item|%>
      $<%= item["cost"] %>
      <%= item["name"] %>
      <%= item["username"] %><br>
   <% end %>
<% end %>
<br>

<div class="spacer">
</div>

<footer>
    <div class="row">
      <div class="col-md-4">
        <ul class="left_footer_info">
          <li class="sphere_title"><%= @sphere.name %></li>
          <li><span class="left_descriptors">Ideal Share: </span><span class="created_date">$<%= total_expense_amount_sphere(@sphere) / number_of_user_in_sphere(@id) %></span></li>
          <li>
            <span class="left_descriptors">Homies: </span><span class="sphere_description">
              <% @connections.each do |connection| %>
                <% user = User.find_by_id(connection.user_id) %>
                <%= user.username %>
                <img src=<%= user.img_url %> width="30" height="30">
              <% end %>
            </span>
          </li>
          <li class="edit_homie"><%= link_to "Edit homies", connections_path, :class => "grey"%>
          </li>
      </div>

      <div class="col-md-4">
          <ul class="large_expense">
            <li><span class="small_dollar">$</span><span class="big_number"><%= number_to_currency(total_expense_amount_sphere(@sphere))%></span></li>
            <li class="total_expense">total expenses</li>
          </ul>
      </div>


      <div class="col-md-4">
      <%= link_to new_user_sphere_expense_path do %>
        <div class="btn btn-lg btn-primary btn-block add_expense">Add Expense</div>
      <% end %>

      <%= link_to edit_user_sphere_path(id: @sphere.id), :class => "no_underline" do %>
        <div class="btn btn-lg btn-primary btn-block add_expense">Edit Sphere</div>
      <% end %>
      <div class="destroy_sphere">
        <%= link_to 'Destroy Sphere', user_sphere_path(id: @sphere.id), method: :delete, :class => "grey", data: { confirm: 'Are you sure?' } %>
      </div>

      </div>

    </div>
  </footer>



<script type="text/javascript">
  function init() {

    CanvasJS.addColorSet("colorShades",
    [
      "#7364AC",
      "#9F96C1",
      "#40489D",
      "#557EC0",
      "#A4C9EA"
    ]);

    var chart1 = new CanvasJS.Chart("chartContainer1",
    {
      colorSet: "colorShades",
      axisX:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
          labelFontColor: "#EEEFF0",

      },
      axisY:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
          labelFontColor: "#EEEFF0",
      },
      backgroundColor: null,
      data: [
      {
        type: "bar",
        dataPoints: [
          <% total_expense_by_category(@id).each do |expense|%>
            { y:<%= expense["sum"] %>, label:"<%= expense["name"] %>" },
          <% end %>
        ]
      },
      ]
    });

var chart5 = new CanvasJS.Chart("chartContainer5",
   {
     colorSet: "colorShades",
      backgroundColor: null,
      toolTip:{
        enabled: true,
        content: "{legendText}: {y}"
      },
      axisX:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,

      },
      axisY:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
          labelFontColor: "#EEEFF0",
      },
      data: [
        <% categories_per_sphere(@id).each do |cat|%>
          {
          type: "stackedBar",
          legendText: "<%= cat["name"] %>",

          dataPoints: [

          <% usernames_per_sphere(@id).each do |user|%>
              { label: "<%= user["username"] %>" , y: <%= cat_sum_with_default(@id, cat["id"], user["id"]) %>},
          <% end %>
          ]
        },
        <% end %>

      ]
   });

chart5.render();
chart1.render();

}
window.onload = init();

</script>

<hr>
