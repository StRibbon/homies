<h1><%= @sphere.name %>
</h1>
<%= link_to "Edit Sphere", edit_user_sphere_path(id: @sphere.id) %>
<%= link_to 'Destroy Sphere', user_sphere_path(id: @sphere.id), method: :delete, data: { confirm: 'Are you sure?' } %>
<h5>
<%= link_to "Edit h0mie$", connections_path %>:
<% @connections.each do |connection| %>
<% user = User.find_by_id(connection.user_id) %>
<%= user.username %>
<img src=<%= user.img_url %> width="40">
<% end %>
</h5>

<br>

<%= link_to "Add Expense", new_user_sphere_expense_path %>
<ul>
<% @expenses.each do |expense| %>
<li>
<strong>Name:</strong> <%= expense.name %>
<strong>Cost:</strong> <%= expense.cost %>
<strong>Notes:</strong> <%= expense.notes %>
<strong>Category:</strong> <%= expense.category.name %>

<%= link_to "Edit", edit_expense_path(expense.id) %>
<%= link_to "Delete", expense_path(expense.id), method: :delete, data: { confirm: 'Are you sure?' } %>

</li>
<% end %>
</ul>
<h4>Total</h4>
$<%= total_expense_amount_sphere(@sphere)%>
<br>
<h4>Number of users in sphere</h4>
<%= number_of_user_in_sphere(@id) %>
<h4>Per person</h4>
<%= total_expense_amount_sphere(@sphere) / number_of_user_in_sphere(@id) %>
<h4>Total spend by Category</h4>
<% total_expense_by_category(@id).each do |expense|%>
  $<%= expense["sum"] %>
  <%= expense["name"] %> <br>
<% end %>
<br>
<h4>Total spend by User</h4>
<% total_expense_by_user(@id).each do |expense|%>
  $<%= expense["sum"] %>
  <%= expense["username"] %> <br>
<% end %>

<h4>Expense by User</h4>
<% user_id_in_sphere(@id).each do |user|%>
   <% x = user["user_id"] %>
   <% itemized_expense_by_user(@id, x).each do |item|%>
      $<%= item["cost"] %>
      <%= item["name"] %>
      <%= item["username"] %><br>
   <% end %>
<% end %>
<br>
<h4>Expense by Category by User</h4>
<% user_id_in_sphere(@id).each do |user|%>
   <% x = user["user_id"] %>
   <% total_expense_by_category_by_user(@id, x).each do |item|%>
      $<%= item["sum"] %>
      <%= item["name"] %>
      <%= item["username"] %><br>
   <% end %>
<% end %>
<h4>Expense by User by Category</h4>
<% cat_id_in_sphere(@id).each do |cat|%>
   <% x = cat["category_id"] %>
   <% total_expense_by_user_by_cat(@id, x).each do |item|%>
      $<%= item["sum"] %>
      <%= item["name"] %>
      <%= item["username"] %><br>
   <% end %>
<% end %>

<div id="chartContainer5" style="height: 300px; width: 80%;">
</div>
<div id="chartContainer1" style="height: 300px; width: 80%;">
</div>


<script type="text/javascript">
  window.onload = function () {

    CanvasJS.addColorSet("colorShades",
    [
      "#7364AC",
      "#9F96C1",
      "#40489D",
      "#557EC0",
      "#A4C9EA"
    ]);

    var chart1 = new CanvasJS.Chart("chartContainer1",
    {
      colorSet: "colorShades",
      title:{
        text: "<%= @sphere.name %> Total by Category",
        fontFamily: "Josefin Sans"
      },
      axisX:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
      },
      axisY:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
      },
      backgroundColor: null,
      data: [
      {
        type: "bar",
        dataPoints: [
          <% total_expense_by_category(@id).each do |expense|%>
            { y:<%= expense["sum"] %>, label:"<%= expense["name"] %>" },
          <% end %>
        ]
      },
      ]
    });

var chart5 = new CanvasJS.Chart("chartContainer5",
   {
     colorSet: "colorShades",
     title:{
      text: "Expenses by User",
      fontFamily: "Josefin Sans"
      },
      backgroundColor: null,
      toolTip:{
        enabled: true,
        content: "{legendText}: {y}"
      },
      axisX:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
      },
      axisY:{
          gridThickness:0,
          lineThickness:0,
          tickLength:0,
      },
      data: [
        <% categories_per_sphere(@id).each do |cat|%>
          {
          type: "stackedBar",
          legendText: "<%= cat["name"] %>",
          showInLegend: "true",
          dataPoints: [

          <% usernames_per_sphere(@id).each do |user|%>
              { label: "<%= user["username"] %>" , y: <%= cat_sum_with_default(@id, cat["id"], user["id"]) %>},
          <% end %>
          ]
        },
        <% end %>

      ]
   });

chart5.render();
chart1.render();
}
</script>

<hr>
